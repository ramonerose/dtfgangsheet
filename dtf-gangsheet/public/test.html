<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload PDF for Gang Sheet</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .sheet-item { margin: 5px 0; }
    .cost { color: green; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Upload PDF for Gang Sheet</h1>

  <form id="uploadForm">
    <label>Select PDF file: <input type="file" id="file" required /></label><br><br>
    <label>Quantity: <input type="number" id="quantity" min="1" required /></label><br><br>

    <label>Rotate 90¬∞?
      <select id="rotate">
        <option value="false">No</option>
        <option value="true">Yes</option>
      </select>
    </label><br><br>

    <!-- ‚úÖ NEW: Gang Sheet Width -->
    <label>Gang Sheet Width:
      <select id="gangWidth">
        <option value="22" selected>22 inches</option>
        <option value="30">30 inches</option>
      </select>
    </label><br><br>

    <!-- ‚úÖ NEW: Max Sheet Length -->
    <label>Max Sheet Length (inches):
      <input type="number" id="maxLength" min="12" value="200" />
    </label><br><br>

    <button type="submit">Generate Gang Sheet</button>
  </form>

  <hr>

  <div id="log"></div>

  <script>
    const form = document.getElementById("uploadForm");
    const logDiv = document.getElementById("log");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      logDiv.innerHTML = "‚è≥ Uploading...";

      const file = document.getElementById("file").files[0];
      const quantity = document.getElementById("quantity").value;
      const rotate = document.getElementById("rotate").value;
      const gangWidth = document.getElementById("gangWidth").value;
      const maxLength = document.getElementById("maxLength").value;

      const formData = new FormData();
      formData.append("file", file);
      formData.append("quantity", quantity);
      formData.append("rotate", rotate);
      formData.append("gangWidth", gangWidth);
      formData.append("maxLength", maxLength);

      const response = await fetch("/merge", {
        method: "POST",
        body: formData
      });

      if (!response.ok) {
        logDiv.innerHTML = "‚ùå Server error!";
        return;
      }

      const data = await response.json();

      let html = `<p>‚úÖ ${data.sheets.length} sheets generated!</p><br><strong>Sheets:</strong><ul>`;
      data.sheets.forEach((s, idx) => {
        html += `<li class="sheet-item">üìÑ ${s.filename} ‚Üí <span class="cost">üí∞ $${s.cost.toFixed(2)}</span> 
        <a href="data:application/pdf;base64,${s.pdfBase64}" download="${s.filename}">‚¨áÔ∏è Download</a></li>`;
      });
      html += `</ul><strong>Total Cost: $${data.totalCost.toFixed(2)}</strong><br><br>`;

      // ‚úÖ Download all as zip
      html += `<button id="downloadAll">‚¨áÔ∏è Download All</button>`;
      logDiv.innerHTML = html;

      // When clicking "Download All", zip all PDFs
      document.getElementById("downloadAll").addEventListener("click", () => {
        data.sheets.forEach(s => {
          const a = document.createElement("a");
          a.href = `data:application/pdf;base64,${s.pdfBase64}`;
          a.download = s.filename;
          a.click();
        });
      });
    });
  </script>
</body>
</html>
